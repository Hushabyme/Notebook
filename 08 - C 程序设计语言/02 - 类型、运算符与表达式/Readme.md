# 第2章 类型、运算符与表达式 

变量和常量是程序处理的两种基本数据对象。 

声明语句说明变量的名字及类型，也可以指定变量的初值。运算符指定将要进行的操作。表达式则把变量与常量组合起来生成新的值。 

ANSI 标准对语言的基本类型与表达式做了许多小的修改与增补。所有整型都包括 signed（带符号）和 unsigned（无符号）两种形式，且可以表示无符号常量与十六进制字符常量。浮点运算可以以单精度进行，还可以使用更高精度的 long double 类型运算。字符串常量可以在编译时连接。ANSI C 还支持枚举类型，该语言特性经过了长期的发展才形成。对象可以声明为 const（常量）类型，表明其值不能修改。该标准还对算术类型之间的自动强制转换规则进行了扩充，以适合于更多的数据类型。  

> 这里有一句题外话，直到 ES6 的出现，JavaScript 语言才真正拥有了 const（因为此前它仅仅是作为保留字，而未发布）。

## 2.1 变量名 

名字是由字母和数字组成的序列，但其第一个字符必须为字母。下划线 “_” 被看做是字母，通常用于命名较长的变量名，以提高其可读性。 例如：

```
this_is_an_apple
```

由于例程的名字通常以下划线开头，因此变量名不要以下划线开头。大写字母与小写字母是有区别的，所以，x 与 X 是两个不同的名字。**在传统的 C 语言用法中，变量名使用小写字母，符号常量名全部使用大写字母**。 

对于内部名而言，至少前 31 个字符是有效的。函数名与外部变量名包含的字符数目可能小于 31，这是因为汇编程序和加载程序可能会使用这些外部名，而语言本身是无法控制加载和汇编程序的。对于外部名，ANSI 标准仅保证前 6 个字符的惟一性，并且不区分大小写。类似于 if、else、int、float 等关键字是保留给语言本身使用的，不能把它们用做变量名。所有关健字中的字符都必须小写。

选择的变量名要能够尽量从字面上表达变量的用途，这样做不容易引起混淆。局部变量一般使用较短的变量名（尤其是循环控制变量），外部变量使用较长的名字。 

> 如果你也使用过除此之外的其它高级语言，那么你就会对这一点深感赞同，因为这就是你平时所使用的原则。

## 2.2 数据类型及长度 

C 语言只提供了下列几种基本数据类型： 

```c
char   字符型，占用一个字节，可以存放本地字符集中的一个字符
int    整型，通常反映了所用机器中整数的最自然长度
float  单精度浮点型
double 双精度浮点型
```

此外，还可以在这些基本数据类型的前面加上一些限定符。

short 与 long 两个限定符用于限定整型： 

```
short int sh;
long int counter;
```

**在上述这种类型的声明中，关键字 int 可以省略**。通常很多人也习惯这么做。 

short 与 long 两个限定符的引入可以为我们提供满足实际需要的不同长度的整型数。

**int 通常代表特定机器中整数的自然长度**。short 类型通常为 16 位，1ong 类型通常为 32 位，int 类型可以为 16 位或 32 位。各编译器可以根据硬件特性自主选择合适的类型长度，但要遵循下列限制： short 与 int 类型至少为 16 位， 而 long 类型至少为 32 位， 并且 short 类型不得长于 int 类型，而 int 类型不得长于 long 类型。  

> 也就是 short ＜ int ＜ long

**类型限定符 signed 与 unsigned 可用于限定 char 类型或任何整型**。unsigned 类型的数总是正值或 0，并遵守算术模 2^n 定律，其中 n 是该类型占用的位数。例如，如果 char 对象占用 8 位，那么 unsigned char 类型变量的取值范围为 0～255，而 signed char 类型变量的取值范围则为 -128～127（在采用对二的补码的机器上） 。不带限定符的 char 类型对象是否带符号则取决于具体机器，但可打印字符总是正值。 

> 关于相关的解释可以查看：[c语言中有符号和无符号的区别](http://blog.csdn.net/changyourmind/article/details/53540654)

long double 类型表示高精度的浮点数。同整型一样，浮点型的长度也取决于具体的实现。float、double 与 long double 类型可以表示相同的长度，也可以表示两种或三种不同的长度。 

## 2.3 常量 

类似于 1234 的整数常量属于 int 类型。long 类型的常量以字母 l 或 L 结尾，如 123456789L。如果一个整数太大以至于无法用 int 类型表示时，也将被当作 long 类型处理。无符号常量以字母 u 或 U 结尾。后缀 ul 或 UL 表明是 unsigned long 类型。 

浮点数常量中包含一个小数点（如 123.4）或一个指数（如 1e-2） ，也可以两者都有。没有后缀的浮点数常量为 double 类型。后缀 f 或 F 表示 float 类型，而后缀 l 或 L 则表示 long double 类型。 

整型数除了用十进制表示外，还可以用八进制或十六进制表示。带前缀 0 的整型常量表示它为八进制形式；前缀为 0x 或 0X，则表示它为十六进制形式。例如，十进制数 31 可以写成八进制形式 037，也可以写成十六进制形式 0x1f 或 0X1F。八进制与十六进制的常量也可以使用后缀 L 表示 long 类型，使用后缀 U 表示 unsigned 类型。例如，0XFUL 是一个 unsigned long 类型（无符号长整型）的常量，其值等于十进制数 15。 

一个字符常量是一个整数，书写时将一个字符括在单引号中，如，'x'。字符在机器字符集中的数值就是字符常量的值。例如，在 ASCII 字符集中，字符 '0' 的值为 48，它与数值 0 没有关系。如果用字符 '0' 代替这个与具体字符集有关的值（比如 48），那么，程序就无需关心该字符对应的具体值，增加了程序的易读性。字符常量一般用来与其它字符进行比较，但也可以像其它整数一样参与数值运算。

> 由此让我想起了 JavaScript 中经典的 1 + "1" = 11 而不是 2。如果你有 C 语言的基础，那么你就会见怪不怪了。初学 JavaScript 的同学对此非常的困惑。

ANSI C 语言中的全部转义字符序列如下所示：

```
\a 响铃符       \\ 反斜杠
\b 回退符       \? 问号
\f 换页符       \' 单引号
\n 换行符       \" 双引号
\r 回车符       \ooo 八进制数
\t 横向制表符   \xhh 十六进制数
\v 纵向制表符
```

字符常量 '\0' 表示值为 0 的字符，也就是空字符（null）。我们通常用'\0'的形式代替 0，以强调某些表达式的字符属性，但其数字值为 0。 

常量表达式是仅仅只包含常量的表达式。这种表达式在编译时求值，而不在运行时求值。它可以出现在常量可以出现的任何位置，例如： 

```c
#define MAXLINE 1000
char line[MAXLINE+1];
```

字符串常量也叫字符串字面值，是用双引号括起来的 0 个或多个字符组成的字符序列。 

```
"I am a string"
```

其中 "" 表示空字符串。但是双引号并不是字符串的一部分，它只是用于限定字符串。

从技术角度看，字符串常量就是字符数组。字符串的内部表示使用一个空字符 '\0' 作为串的结尾，因此。存储字符串的物理存储单元数比括在双引号中的字符数多一个。这种表示方法也说明，C 语言对字符串的长度没有限制，但程序必须扫描完整个字符串后才能确定字符串的长度。 

枚举常量是另外一种类型的常量。枚举是一个常量整型值的列表，例如： 

```
enum boolean { NO, YES };
```

在没有显式说明的情况下，enum 类型中第一个枚举名的值为 0，第二个为 1，依此类推。 

枚举为建立常量值与名字之间的关联提供了一种便利的方式。 相对于#define 语句来说，它的优势在于常量值可以自动生成。尽管可以声明 enum 类型的变量，但编译器不检查这种类型的变量中存储的值是否为该枚举的有效值。不过，枚举变量提供这种检查，因此枚举比 define 更具优势。此外，调试程序可以以符号形式打印出枚举变量的值。

## 2.4 声明 

所有变量都必须先声明后使用，尽管某些变量可以通过上下文隐式地声明。一个声明指定一种变量类型，后面所带的变量表可以包含一个或多个该类型的变量。 

一个声明语句中的多个变量可以拆开在多个声明语句中声明。 例如：

```c
int a, b, sum;
```

等价于：

```c
int a;
int b;
int sum;
```

按照这种形式书写代码需要占用较多的空间，但便于向各声明语句中添加注释，也便于以后修改。 

还可以在声明的同时对变量进行初始化。在声明中，如果变量名的后面紧跟一个等号以及一个表达式，该表达式就充当对变量进行初始化的初始化表达式。例如： 

```c
int a = 1;
int b = 2;
char name = "Hello"
```

如果变量不是自动变量，则只能进行一次初始化操作，从概念上讲，应该是在程序开始执行之前进行，并且初始化表达式必须为常量表达式。每次进入函数或程序块时，显式初始化的自动变量都将被初始化一次，其初始化表达式可以是任何表达式。默认情况下，外部变量与静态变量将被初始化为 0。未经显式初始化的自动变量的值为 undefined（即无效值） 。 

任何变量的声明都可以使用 const 限定符限定。该限定符指定变量的值不能被修改。**对数组而言，const 限定符指定数组所有元素的值都不能被修改** 。

## 2.5 算术运算符 

二元算术运算符包括：+、-、*、/、%（取模运算符） 。整数除法会截断结果中的小数部分。 

取模运算符%不能应用于 float 或 double 类型。在有负操作数的情况下，整数除法截取的方向以及取模运算结果的符号取决于具体机器的实现，这和处理上溢或下溢的情况是一样的。 

二元运算符+和-具有相同的优先级，它们的优先级比运算符 *、/ 和 % 的优先级低，而运算符 *、/和 % 的优先级又比一元运算符+和-的优先级低。算术运算符采用从左到右的结合规则。 

## 2.6 关系运算符与逻辑运算符 

关系运算符包括下列几个运算符： >、>=、<、<= 

它们具有相同的优先级。优先级仅次于它们的是相等性运算符： ==、!=

**关系运算符的优先级比算术运算符低**。 

逻辑运算符 &&与||有一些较为特殊的属性，由 &&与||连接的表达式按从左到右的顺序进行求值，并且，在知道结果值为真或假后立即停止计算。 

根据定义，在关系表达式或逻辑表达式中，如果关系为真，则表达式的结果值为数值 1；如果为假，则结果值为数值 0。 

逻辑非运算符!的作用是将非 0 操作数转换为 0，将操作数 0 转换为 1。该运算符通常用于下列类似的结构中： 

```c
if (!valid)
```

## 2.7 类型转换 

当一个运算符的几个操作数类型不同时，就需要通过一些规则把它们转换为某种共同的类型。 

一般来说，自动转换是指把“比较窄的”操作数转换为“比较宽的”操作数，并且不丢失信息的转换，例如，在计算表达式 `f + i` 时，将整型变量 i 的值自动转换为浮点型（这里的变量 f 为浮点型） 。 

由于 char 类型就是较小的整型，因此在算术表达式中可以自由使用 char 类型的变量，这就为实现某些字符转换提供了很大的灵活性。 

将字符类型转换为整型时，我们需要注意一点。C 语言没有指定 char 类型的变量是无符号变量（signed）还是带符号变量（unsigned） 。当把一个 char 类型的值转换为 int 类型的值时，其结果有没有可能为负整数？对于不同的机器，其结果也不同，这反映了不同机器结构之间的区别。在某些机器中，如果 char 类型值的最左一位为 1，则转换为负整数（进行“符号扩展” ） 。而在另一些机器中，把 char 类型值转换为 int 类型时，在 char 类型值的左边添加 0，这样导致的转换结果值总是正值。 

C 语言的定义保证了机器的标准打印字符集中的字符不会是负值，因此，在表达式中这些字符总是正值。但是，存储在字符变量中的位模式在某些机器中可能是负的，而在另一些机器上可能是正的。为了保证程序的可移植性，如果要在 char 类型的变量中存储非字符数据，最好指定 signed 或 unsigned 限定符。 

C 语言中，很多情况下会进行隐式的算术类型转换。一般来说，如果二元运算符（具有两个操作数的运算符称为二元运算符，比如+或*）的两个操作数具有不同的类型，那么在进行运算之前先要把“较低”的类型提升为“较高”的类型，运算的结果为较高的类型。 

例如：

```
int a = 1;
float b = 1.2;
```

在将 a 与 b 相加时，内部会将 int 定义的 a 提升为 float 类型。

但是，注意，表达式中 float 类型的操作数不会自动转换为 double 类型，这一点与最初的定义有所不同。 

当表达式中包含 unsigned 类型的操作数时，转换规则要复杂一些。主要原因在于，带符号值与无符号值之间的比较运算是与机器相关的，因为它们取决于机器中不同整数类型的大小。 

## 2.8 自增运算符与自减运算符 

C 语言提供了两个用于变量递增与递减的特殊运算符。自增运算符++使其操作数递增 1，自减运算符使其操作数递减 1。 

> 对此不再进一步介绍，因为它很简单。

## 2.9 按位运算符 

C 语言提供了 6 个位操作运算符。这些运算符只能作用于整型操作数，即只能作用于带符号或无符号 char、short、int、long 类型： 

```
&   按位与（AND）
|   按位或（OR）
^   按位异或（XOR）
<<  左移
>>  右移
~   按位求反（一元运算符）
```

## 2.10 赋值运算符与表达式 

在赋值表达式中，如果表达式左边的变量重复出现在表达式的右边，如： 

```
i = i + 2;
```

等价于：

```
i += 2;
```

## 2.11 条件表达式 

条件表达式最常用的就是 if else 的形式，除此之外就是三元表达式了。


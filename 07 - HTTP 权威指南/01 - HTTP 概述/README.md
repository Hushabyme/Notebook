# 第 1 章 HTTP 概述

不管是什么教程，什么书，在开篇一定是要对所要讲述的内容进行简要介绍。本章的工作就是如此。

每天，都有数以亿万计的图片、HTML 页面、文本文件、电影、音频文件、Java 小程序和其他资源在因特网上游弋。

HTTP 使用的是可靠的数据传输协议，因此即使数据来自地球的另一端，它也能够确保数据在传输的过程中不会被损坏或产生混乱。

下面，就让我们来近距离地观察一下 HTTP 是如何传输 Web 流量的。

## 1.1 Web 客户端和服务器

Web 内容都是存储在 Web 服务器上的。Web 服务器所使用的是 HTTP 协议，因此经常会被称为 HTTP 服务器。

如果 HTTP 客户端发起请求的话，它们就会提供数据，客户端向服务器发送 HTTP 请求，服务器会在 HTTP 响应中送回所请求的内容。

举一个简单的例子，比如你正使用某一浏览器输入一网址（比如 https://www.baidu.com），那么浏览器奶骑就会向服务器发送一条要请求该页面的 HTTP 请求，如果成功，那么就会返回该页面并呈现给你，但其中还包含了很多其它的信息，我们以后会一一提到。

## 1.2 资源

Web 服务器是 Web 资源的宿主。Web 资源是 Web 内容的源头。

最简单的 Web 资源就是 Web 服务器文件系统中的静态文件。这些文件可以包含任意内容：文本文件、HTML 文件、微软的 Word 文件、Adobe 的 Acrobat 文件、JPG 图片文件、rmvb 电影文件或所有其他你能够想到的格式。

当然资源不全是静态的，还可以是动态的。比如进行在线股票交易，那么它就是时时改变的资源。

总之，所有类型的内容来源都是资源。

### 1.2.1 媒体类型

因特网上有数千种不同的数据类型，HTTP 仔细地给每种要通过 Web 传输的对象都打上名为 MIME 类型（MIME type）的数据格式标签。最初设计 MIME（Multipurpose Internet Mail Extension，多用途因特网邮件扩展）是为了解决在不同的电子邮件系统之间搬移报文时存在的问题。MIME 在电子邮件系统中工作得非常好，因此 HTTP 也采纳了它，用它来描述并标记多媒体内容。

Web 服务器会为所有 HTTP 对象数据附加一个 MIME 类型，当 Web 浏览器从服务器中取回一个对象时，会去查看相关的 MIME 类型，看看它是否知道应该如何处理这个对象。

**MIME 类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。**

- HTML 格式的文本文档由 text/html 类型来标记。
- 普通 ASCII 文本文档由 text/plain 类型来标记。
- JPEG 类型的图片由 image/jpeg 类型来标记。
- Gif 类型的图片由 image/gif类型来标记。

常见的 MIME 类型有数百个，实验性或用途有限的 MIME 类型则更多。

### 1.2.2 URI

每个 Web 服务器资源都有一个名字，这样客户端就可以说明它们感兴趣的资源是什么了。服务器资源名被称为**统一资源标识符（Uniform Resource Identifier，URI）**。

给定了 URI，HTTP 就可以解析出对象。URI 有两种形式，分别称为 URL 和 URN。现在我们分别来看看这些资源标识符类型。

### 1.2.3 URL

**统一资源定位符（URL）**是资源标识符最常见的形式。URL 描述了一台特定服务器上某资源的特定位置。它们可以明陇说明如何从一个精确、固定的位置获取资源。

大部分 URL 都遵循一种标准格式，这种格式包含三个部分。

- URL 的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型。这
  部分通常就是 HTTP 协议（http:// ）。
- 第二部分给出了服务器的因特网地址（比如 www.baidu.com）。
- 其余部分指定了 Web 服务器上的某个资源（比如 /index.html）。

现在，几乎所有的 URI 都是 URL。

### 1.2.4 URN

URI 的第二种形式就是**统一资源名（URN）**。URN 是作为特定内容的唯一名称使用的，与目前的资源所在地无关。使用这些与位置无关的 URN，就可以将资源四处搬移。

为了更有效地工作，URN 需要一个支撑架构来解析资源的位置。而此类架构的缺乏也就延缓了其被采用的进度。

因此，本书主要所说的就是 URI 和 URL，但不加以区别使用。

## 1.3 事务

一个 HTTP 事务是由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是通过名为 HTTP 报文（HTTP message）的格式化数据块进行的。

### 1.3.1 方法

HTTP 支持几种不同的命令，这些命令就被称为 HTTP 方法。

最常见的就是 GET 和 POST 方法。

### 1.3.2 状态码

每条 HTTP 响应报文返回时都会携带一个状态码。状态码是一个三位数字的代码，告知客户端请求是否成功，或者是否需要采取其他动作。

几种常见的状态码：

| HTTP 状态码 | 描述        |
| -------- | --------- |
| 200      | 文档正确返回    |
| 302      | 到其它地方获取资源 |
| 404      | 无法找到这个资源  |

## 1.4 报文

现在我们来快速浏览一下 HTTP 请求和响应报文的结构。

HTTP 报文是由一行一行的简单字符串组成的。HTTP 报文都是纯文本，不是二进制代码，所以人们可以很方便地对其进行读写。

从客户端发往 Web 服务器的 HTTP 报文称为**请求报文（request message）**。从
服务器发往客户端的报文称为**响应报文（response message）**，此外没有其他类型的
HTTP 报文。HTTP 请求和响应报文的格式很类似。

HTTP报文包括以下三个部分。

- **起始行**

  报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况。 

- **首部字段**

  起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值，为了便于解析，两者之间用冒号（:）来分隔。首部以一个空行结束。添加一个首部字段和添加新行一样简单。 

- **主体** 

  空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送给 Web 服务器的数据；响应主体中装载了要返回给客户端的数据。起始行和首部都是文本形式且都是结构化的，而主体则不同，主体中可以包含任意的二进制数据（比如图片、视频、音轨、软件程序）。当然，主体中也可以包含文本。 

## 1.5 连接

概要介绍了 HTTP 报文的构成之后，我们来讨论一下报文是如何通过传输控制协议（TransmissionControl Protocol，TCP）连接从一个地方搬移到另一个地方去的。 

### 1.5.1 TCP/IP 

HTTP 是个应用层协议。HTTP 无需操心网络通信的具体细节；它把联网的细节都交给了通用、可靠的因特网传输协议 TCP/IP。 

TCP 提供了： 

- 无差错的数据传输。
- 按序传输（数据总是会按照发送的顺序到达）。
- 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）。

因特网自身就是基于 TCP/IP 的，TCP/IP 是全世界的计算机和网络设备常用的层次化分组交换网络协议集。TCP/IP 隐藏了各种网络和硬件的特点及弱点，使各种类型的计算机和网络都能够进行可靠地通信。 

**只要建立了 TCP 连接，客户端和服务器之间的报文交换就不会丢失、不会被破坏，也不会在接收时出现错序了**。 

用网络术语来说，HTTP 协议位于 TCP 的上层。HTTP 使用 TCP 来传输其报文数据。与之类似，TCP则位于 IP 的上层。 

### 1.5.2 连接、IP地址及端口号 

在 HTTP 客户端向服务器发送报文之前，需要用**网际协议（Internet Protocol，IP）**地址和端口号在客户端和服务器之间建立一条 TCP/IP 连接。 

在 TCP 中，你需要知道服务器的 IP 地址，以及与服务器上运行的特定软件相关的 TCP 端口号。 

这就行了，但最初怎么获得 HTTP 服务器的 IP 地址和端口号呢？当然是通过 URL 了！我们前面曾提到过，URL 就是资源的地址，所以自然能够为我们提供存储资源的机器的 IP 地址。 

我们来看几个 URL：

1. http://207.200.83.29:80/index.html 

   这个 URL 使用了机器的 IP 地址，207.200.83.29 以及端口号 80。 

2. http://www.netscape.com:80/index.html 

   这个 URL 没有使用数字形式的 IP 地址，它使用的是文本形式的域名，或者称为主机名
   （www.netscape.com）。主机名就是 IP 地址比较人性化的别称。可以通过一种被称为域名服务（Domain Name Service，DNS）的机制方便地将主机名转换为 IP 地址，这样所有问题就都解决了。 

3. http://www.netscape.com/index.html 

   最后一个 URL 没有端口号。HTTP 的 URL 中没有端口号时，可以假设默认端口号是80。 

有了 IP 地址和端口号，客户端就可以很方便地通过 TCP/IP 进行通信了。下图就显示了浏览器是怎样通过 HTTP 显示位于远端服务器中的某个简单 HTML 资源的。 

步骤如下：
(a) 浏览器从 URL 中解析出服务器的主机名；
(b) 浏览器将服务器的主机名转换成服务器的 IP 地址；
(c) 浏览器将端口号（如果有的话）从 URL 中解析出来；
(d) 浏览器建立一条与 Web 服务器的 TCP 连接；
(e) 浏览器向服务器发送一条 HTTP 请求报文；
(f) 服务器向浏览器回送一条 HTTP 响应报文；
(g) 关闭连接，浏览器显示文档。 

## 1.6 Web 的结构组件 

在本章的概述中，我们重点介绍了两个 Web 应用程序（Web 浏览器和 Web 服务器）是如何相互发送报文来实现基本事务处理的。在因特网上，要与很多 Web 应用程序进行交互。在本节中，我们将列出其他一些比较重要的应用程序，如下所示。 

### 1.6.1 代理

首先我们来看看 HTTP 代理服务器，这是 Web 安全、应用集成以及性能优化的重要组成模块。 

如图所示，代理位于客户端和服务器之间，接收所有客户端的 HTTP 请求，并将这些请求转发给服务器（可能会对请求进行修改之后转发）。对用户来说，这些应用程序就是一个代理，代表用户访问服务器。 

出于安全考虑，通常会将代理作为转发所有 Web 流量的可信任中间节点使用。代理还可以对请求和响应进行过滤。 

### 1.6.2 缓存

Web 缓存（Web cache）或代理缓存（proxy cache）是一种特殊的 HTTP 代理服务器，可以将经过代理传送的常用文档复制保存起来。下一个请求同一文档的客户端就可以享受缓存的私有副本所提供的服务了（参见图 1-12）。 

客户端从附近的缓存下载文档会比从远程 Web 服务器下载快得多。 

### 1.6.3 网关

网关（gateway）是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于将 HTTP 流量转换成其他的协议。网关接受请求时就好像自己是资源的源端服务器一样。客户端可能并不知道自己正在与一个网关进行通信。 

### 1.6.4 隧道 

隧道（tunnel）是建立起来之后，就会在两条连接之间对原始数据进行盲转发的 HTTP 应用程序。HTTP 隧道通常用来在一条或多条 HTTP 连接上转发非 HTTP 数据，转发时不会窥探数据。 

HTTP 隧道的一种常见用途是通过 HTTP 连接承载加密的安全套接字层（SSL， Secure Sockets Layer）流量，这样 SSL 流量就可以穿过只允许 Web 流量通过的防火墙了。 

### 1.6.5 Agent代理 

用户 Agent 代理（或者简称为 Agent 代理）是代表用户发起 HTTP 请求的客户端程序。所有发布 Web 请求的应用程序都是 HTTP Agent 代理。到目前为止，我们只提到过一种 HTTP Agent 代理：Web 浏览器，但用户 Agent 代理还有很多其他类型。 

以上就是本章的简要介绍了，让我们开始下一章的学习吧。
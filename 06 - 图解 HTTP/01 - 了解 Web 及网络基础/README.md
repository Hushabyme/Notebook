# 第一章 了解 Web 及网络基础

本章概述了 Web 是建立在何种技术之上，以及 HTTP 协议是如何诞生并发展的。我们从其背景着手，来深入了解这部分内容。

## 1.1 使用 HTTP 协议访问 Web

你知道当我们在网页浏览器（ Web browser） 的地址栏中输入 URL 时，Web 页面是如何呈现的吗？ 

Web 页面当然不能凭空显示出来。根据 Web 浏览器地址栏中指定的 URL，Web 浏览器从 Web 服务器端获取文件资源（ resource）等信息，从而显示出 Web 页面。

像这种通过发送请求获取服务器资源的 Web 浏览器等，都可称为**客户端（ client）**。 最常见的要数我们平时使用的诸如 Google、Firefox、IE 等浏览器了。

![1](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\1.png)

Web 使用一种名为 HTTP（ HyperText Transfer Protocol，超文本传输协议 ）的协议作为规范，完成从客户端到服务器端等一系列运作流程。而协议是指规则的约定。可以说， Web 是建立在 HTTP 协议上通信的。 

> HTTP 通常被翻译为“超文本传输协议”，但这是不严谨的，从上述英文中我们可以看出，严谨的译名应为“超文本转移协议”。

## 1.2 HTTP 的诞生

在深入学习 HTTP 之前，我们先来介绍一下 HTTP 诞生的背景。了解背景的同时也能了解当初制定 HTTP 的初衷，这样有助于我们更好地理解。 

1989 年 3 月，互联网还只属于少数人。在这一互联网的黎明期，HTTP 诞生了。CERN（ 欧洲核子研究组织）的蒂姆 • 伯纳斯 - 李（ Tim BernersLee）博士提出了一种能让远隔两地的研究者们共享知识的设想。最初设想的基本理念是：借助多文档之间相互关联形成的超文本（ HyperText），连成可相互参阅的 WWW（ World Wide Web，万维网）。  

现在已提出了 3 项 WWW 构建技术，分别是：把 SGML（ Standard Generalized Markup Language， 标准通用标记语言） 作为页面的文本标记语言的 HTML（HyperText Markup Language 超文本标记语言）；作为文档传递协议的 HTTP；指定文档所在地址的 URL（ Uniform Resource Locator， 统一资源定位符）。 

1994 年 的 12 月，网景通信公司发布了 Netscape Navigator 1.0，1995年微软公司发布 Internet Explorer 1.0 和 2.0。

紧随其后的是现在已然成为 Web 服务器标准之一的 Apache，当时它以 Apache 0.2 的姿态出现在世人眼前。而 HTML也发布了 2.0 版本。那一年， Web 技术的发展突飞猛进。 

时光流转，从 1995 年左右起，微软公司与网景通信公司之间爆发的浏览器大战愈演愈烈。 两家公司都各自对 HTML做了扩展，于是导致在写 HTML页面时，必须考虑兼容他们两家公司的浏览器。 时至今日，这个问题仍令那些写前端页面的工程师感到棘手。 

在这场浏览器供应商之间的竞争中， 他们不仅对当时发展中的各种 Web 标准化视而不见，还屡次出现新增功能没有对应说明文档的情况。 

2000 年前后，这场浏览器战争随着网景通信公司的衰落而暂告一段落。 但就在 2004 年， Mozilla 基金会发布了 Firefox 浏览器，第二次浏览器大战随即爆发。 

Internet Explorer 浏览器的版本从 6 升到 7 前后花费了 5 年时间。之后接连不断地发布了 8、 9、 10 版本。另外，Chrome、Opera、Safari 等浏览器也纷纷抢占市场份额。 

HTTP 的标准有 HTTP/0.9、HTTP/1.0、HTTP/1.1、HTTP/2.0。

以前我们最常用的就是 HTTP/1.1标准，也就是 http:// 开头的 URL，而 HTTP/2.0 只支持 https:// 开头的 URL，也就是我们现在乃至未来使用的标准。后面我也会单独写关于 HTTP/2.0 标准的文章。

## 1.3 网络基础 TCP/IP

为了理解 HTTP，我们有必要事先了解一下 TCP/IP 协议族。

通常使用的网络（包括互联网）是在 TCP/IP 协议族的基础上运作的。而 HTTP 属于它内部的一个子集。 

### 1.3.1 TCP/IP 协议族

计算机与网络设备要相互通信，双方就必须基于相同的方法。比如，如何探测到通信目标、由哪一边先发起通信、使用哪种语言进行通信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为协议（protocol）。 

协议中存在各式各样的内容。从电缆的规格到 IP 地址的选定方法、寻找异地用户的方法、双方建立通信的顺序，以及 Web 页面显示需要处理的步骤，等等。 

**像这样把与互联网相关联的协议集合起来总称为 TCP/IP**。也有说法认为，TCP/IP 是指 TCP 和 IP 这两种协议。还有一种说法认为，TCP/IP 是在 IP 协议的通信过程中，使用到的协议族的统称。 

### 1.3.2 TCP/IP 分层管理

TCP/IP 协议族里重要的一点就是分层。

TCP/IP 协议族按层次分别分为以下 4 层：**应用层、 传输层、 网络层和数据链路层**。 

值得一提的是，层次化之后，设计也变得相对简单了。处于应用层上的应用可以只考虑分派给自己的任务，而不需要弄清对方在地球上哪个地方、对方的传输路线是怎样的、 是否能确保传输送达等问题。 

TCP/IP 协议族各层的作用如下： 

- **应用层**

  应用层决定了向用户提供应用服务时通信的活动。 

  TCP/IP 协议族内预存了各类通用的应用服务。比如，FTP（File Transfer Protocol，文件传输协议）和 DNS（Domain Name System，域名系统）服务就是其中两类。 

  HTTP 协议也处于该层。 

- **传输层** 

  传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。 

  在传输层有两个性质不同的协议：TCP（Transmission Control Protocol， 传输控制协议）和 UDP（User Data Protocol，用户数据报协议）。 

- **网络层** 

  网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线） 到达对方计算机，并把数据包传送给对方。 

  与对方计算机之间通过多台计算机或网络设备进行传输时， 网络层所起的作用就是在众多的选项内选择一条传输路线。 

- **链路层（又名数据链路层， 网络接口层）** 

  用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器（即网卡）），及光纤等物理可见部分（还包括连接器等一切传输媒介）。**硬件上的范畴均在链路层的作用范围之内**。 

### 1.3.3 TCP/IP 通信传输流 

![2](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\2.png)

利用 TCP/IP 协议族进行网络通信时， 会通过分层顺序与对方进行通信。

**发送端从应用层往下走， 接收端则往应用层往上走。** 

我们用 HTTP 举例来说明。首先作为发送端的客户端在应用层（HTTP 协议） 发出一个想看某个 Web 页面的 HTTP 请求；接着，为了传输方便，在传输层（TCP 协议）把从应用层处收到的数据（HTTP 请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层；在网络层（IP 协议），增加作为通信目的地的 MAC 地址后转发给链路层。这样一来，发往网络的通信请求就准备齐全了；接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层。当传输到应用层，才能算真正接收到由客户端发送过来的 HTTP 请求。 

如图所示：

![3](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\3.png)

发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之， 接收端在层与层传输数据时，每经过一层时会把对应的首部消去。这种把数据信息包装起来的做法称为**封装（encapsulate）**。 

## 1.4 与 HTTP 关系密切的协议 : IP、 TCP 和 DNS 

下面我们分别针对在 TCP/IP 协议族中与 HTTP 密不可分的 3 个协议（ IP、 TCP 和 DNS）进行说明。 

### 1.4.1 负责传输的 IP 协议 

按层次分，IP（Internet Protocol）网际协议位于网络层。

Internet Protocol 这个名称可能听起来有点夸张，但事实正是如此，因为几乎所有使用网络的系统都会用到 IP 协议。TCP/IP 协议族中的 IP 指的就是网际协议，协议名称中占据了一半位置，其重要性可见一斑。可能有人会把 “IP” 和 “IP 地址” 搞混， “IP” 其实是一种协议的名称。 

IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。**其中两个重要的条件是 IP 地址和 MAC 地址（Media Access Control Address）**。 

IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改。 

**IP 间的通信依赖 MAC 地址**。在网络上，通信的双方在同一局域网（ LAN） 内的情况是很少的，通常是经过多台计算机和网络设备中转才能连接到对方。而在进行中转时， 会利用下一站中转设备的 MAC 地址来搜索下一个中转目标。这时，会采用 **ARP 协议（AddressResolution Protocol）**。

> ARP 是一种用以解析地址的协议，根据通信方的 IP 地址就可以反查出对应的 MAC 地址。 

但是我们需要知道的是，无论哪台计算机、哪台网络设备，它们都无法全面掌握互联网中的细节。在到达通信目标前的中转过程中，那些计算机和路由器等网络设备只能获悉很粗略的传输路线。  

传输的大致情况如图所示：

![4](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\4.png)

这个状态是不是有点像发送快递的过程呢？从广州发往北京的快递，有时候不是直接到达的，而是要经过中途的许多个中转站，才能顺利将包裹送达目的地。

### 1.4.2 确保可靠性的 TCP 协议 

按层次分，TCP 位于传输层，提供可靠的字节流服务。

> 所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大块数据分割成以报文段（ segment） 为单位的数据包进行管理。而可靠的传输服务是指， 能够把数据准确可靠地传给对方。一言以蔽之，TCP 协议为了更容易传送大数据才把数据分割， 而且 TCP 协议能够确认数据最终是否送达到对方。 

为了准确无误地将数据送达目标处，TCP 协议采用了**三次握手（ three-way handshaking）策略**。  

用 TCP 协议把数据包送出去后，TCP 不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。握手过程中使用了 TCP 的标志（flag） —— **SYN（synchronize）和 ACK（acknowledgement）**。 

1. 发送端首先发送一个带 SYN 标志的数据包给对方。
2. 接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。
3.  最后，发送端再回传一个带 ACK 标志的数据包， 代表“握手”结束。 

三次握手的过程图：

![5](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\5.png)

正是由于这种特性的存在，所以这也是前端优化中最常做的工作之一 —— 减少请求次数。

当然除了上述三次握手， TCP 协议还有其他各种手段来保证通信的可靠性。 

## 1.5 负责域名解析的 DNS 服务 

**DNS（Domain Name System）服务**是和 HTTP 协议一样位于应用层的协议。它提供域名到 IP 地址之间的解析服务。

计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。

举个例子，比如，我们使用 `http://www.baidu.com` 这个网址可以访问到百度的首页，同样的我们也可以使用 `119.75.217.109` 这个 IP 地址访问到同样的页面。而 DNS 就是负责将网址解析为 IP 地址的工作。

> **为什么我们要使用 DNS 呢？**
>
> 因为用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP地址问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。
>
> 但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。 

DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。因此，我们要记住，它是双向解析，不是单向解析的。

![6](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\6.png)

## 1.6 各种协议与 HTTP 协议的关系 

学习了和 HTTP 协议密不可分的 TCP/IP 协议族中的各种协议后，我们再通过这张图来了解下 IP 协议、TCP 协议和 DNS 服务在使用 HTTP 协议的通信过程中各自发挥了哪些作用。 

![7](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\7.png)

## 1.7 URI 和 URL 

与 URI（统一资源标识符）相比，我们更熟悉 URL（ Uniform Resource Locator，统一资源定位符）。

URL 正是使用 Web 浏览器等访问 Web 页面时需要输入的网页地址。这个想必大家都了解。 

### 1.7.1 URI

**URI 是 Uniform Resource Identifier 的缩写**。 RFC2396 分别对这 3 个单词进行了如下定义。 

- **Uniform**

  规定统一的格式可方便处理多种不同类型的资源，而不用根据上下文环境来识别资源指定的访问方式。另外， 加入新增的协议方案（如 http: 或 ftp:）也更容易。 

- **Resource**

  **资源的定义是“可标识的任何东西”**。除了文档文件、图像或服务（例如当天的天气预报）等能够区别于其他类型的，全都可作为资源。另外，资源不仅可以是单一的，也可以是多数的集合体。 

- **Identifier** 

  表示可标识的对象。也称为标识符。 

综上所述，URI 就是由某个协议方案表示的资源的定位标识符。协议方案是指访问资源所使用的协议类型名称。 

采用 HTTP 协议时， 协议方案就是 http 或 https。

在充分理解了 URI 之后，也可以使用 URL 替换 URI。

### 1.7.2 URI 格式

表示指定的 URI，要使用涵盖全部必要信息的绝对 URI、绝对 URL 以及相对 URL。  

让我们先来了解一下绝对 URI 的格式： 

![8](E:\Notebook\06 - 图解 HTTP\01 - 了解 Web 及网络基础\images\8.png)

是不是很熟悉？每一天我们登录的网站的网址大部分都是这样的格式。因此，在这里，我们需要注意的就是区分每一个部分所指的含义是什么，这对于我们理解跨域有极大地帮助。
# 第二章 入门示例扩展

本章包括了一些常见的问题 —— 验证用户的输入数据，处理 E-mail 邮件头，把纯文本数据转换为 HTML 等，通过这些问题，你见真正见识到正则表达式的世界。在构造正则表达式时，我会做些尽可能详细的讲解，提供一些启示。

## 使用正则表达式匹配文本

最简单的正则表达式就是检查变量中的文本能否由某个正则表达式匹配。下面的代码检查变量 num 中所包含的字符串，报告该字符串是否全部由数字构成：

```javascript
/**
 * @param {Number} num 测试的数字
* */
function test(num) {
  if (/^[0-9]+$/.test(num)) {
    console.log('yes');
  } else {
    console.log('no');
  }
}

test(0123456789);  // "yes"
test('Hello'); // "no"
```

如果你对上一章的知识有所收获，那么你一定就能明白 `/^[0-9]+$/` 所表达的含义是什么，`[0-9]` 表示匹配任意 0 ~ 9 之间的数字，`+` 表示匹配一个或多个，`^` 和 `$` 限制了所要匹配的部分的开头和结尾都必须为数字，如果去掉它们我们来看一下结果。

```javascript
/[0-9]+/.test('a123b');  // true
```

上述结果不是我们所想要的。现在你应该印象更加深刻了吧。

现在，我们来完善这个例子，首先提示用户输入一个值，接收这个值，用一个正则表达式来验证，确保输入的是一个数值。如果是，我们就将其乘方，否则弹出警报信息。

```javascript
function test(num) {
  if (/^[0-9]+$/.test(num)) {
    return num * num;
  } else {
    return new Error('请输入数字');
  }
}

console.log(test('5'));  // 25
```

你会发现，如果你输入的是一个字符串而非一个数字，那么它还是能返回正确的答案。

在我们学习 JavaScript 的过程中，一定还记得：`"1" + 2` 的结果为 "12" 而不是 "3" 吧。这时因为 JavaScript 中的“隐式转换”所做的好事。此时，我们可以使用正则表达式来解决它，但是还是有些麻烦的。

如果在 JavaScript 中，我们还可以采用另一种解决方法。

```JavaScript
function test(a, b) {
  return Number.parseFloat(a) + Number.parseFloat(b);
}

console.log(test('1', 2));  // 3
```

如果你采用这样的写法，那么你 JavaScript 学的还不错，但如果你采用下面这样的写法，那么你一定是一个高手！

```javascript
function test(a, b) {
  return +a + +b;
}

console.log(test('1', 2));  // 3
```

虽然这里跑题了，没有在讲 JavaScript 中的正则表达式，但是，我这里想说明的是什么？我想表达：在进行编程的过程中，我们要选择合适的手段应对合适的问题，而不是单纯地想使用一种技术就解决所有问题。虽然并没有错，但这样你就永远学不会新知识。这也正是为什么我们要学习正则表达式这么看起来晦涩的语言来解决验证和处理字符串。

好了，回答正题上，如果现在我要匹配的不止整数，还要匹配小数和负数呢？也就是说，现在我想要匹配所有数。因此，我写出了如下的函数：

```javascript
function test(num) {
  if(/^[-+]?[0-9]+(\.[0-9]*)?$/.test(num)) {
    console.log('yes');
  } else {
    console.log('no');
  }
}

test(1);  // test
test(1.2);  // test
test(-1.2);  // test
test(-1.23456);  // test
```

我们把 `/^[-+]?[0-9]+(\.[0-9]*)?$/` 单独拿出来分析。首先，我们匹配第一个字符为 `+` 或 `-` 的字符，但这不是必须的，可以没有；接着，我们匹配 0 ~ 9 的数字，一个或多个；在接下来，我们匹配 `.` ，也就是小数点；接着，我们匹配 0 ~ 9 的数字，零个或多个作为结尾。这样是不是清晰多了？

如果你注意到了 `()` ，那么我就告诉你，括号的作用是分组，也就是将括号内的匹配作为一个整体考虑。

## 简记法

在正则表达式中，我们往往不是单独匹配数字或字符串，有时候，我们还要一同验证，比如邮箱。那么，在正则表达式中，就提供以下一些非常有用的简写：

|  字符  |                匹配                 |
| :--: | :-------------------------------: |
|  .   |     除换行符和 Unicode 行终止符外的任意字符      |
|  \w  |  任何 ASCII 字符组成的单词，等价于[a-zA-Z0-9]  |
|  \W  | 任何 ASCII 字符组成的单词，等价于[ ^a-zA-Z0-9] |
|  \s  |           任何Unicode 空白符           |
|  \S  |   任何非 Unicode 空白符，注意 \w 和S 的区别    |
|  \d  |       任何 ASCII 数字，等价于 [0-9]       |
|  \D  |   除了 ASCII 数字外的任何字符，等价于 [ ^0-9]   |

很多正则表达式的教程都不会告诉你应该怎么记住上面的小写字母和大写字母，当然，记住小写字母也就记住了大写字母。

接下来，我就告诉大家怎么记住它们。没错，就是记住英文。

**w 的全称是 "word"，意思是单词；s 的全称是 "space"，意思是空格；d 的全称是 "digit"，意思是数字。** 如果你英语水平还不错，想必现在你已经将它们全部记住了。

除此之外还有一些直接量字符，比如制表符、回车符、换行符等的简写：

|  字符   |             匹配             |
| :---: | :------------------------: |
|  \o   |           NUL 字符           |
|  \n   |        换行符（\u000A）         |
|  \t   |        制表符（\u0009）         |
|  \v   |       垂直制表符（\u000B）        |
|  \f   |        换页符（\u000C）         |
|  \r   |        回车符（\u000D）         |
| \xnn  |     由十六进制数 nn 指定的拉丁字符      |
| \uxxx | 由十六进制数 xxxx 指定的 Unicode 字符 |
|  \cX  |          控制字符 ^X           |

## 使用正则修改文本

在 JavaScript 中，我们可以使用 `replace` 方法来替换我们所用正则表达式匹配的字符。

比如，我想把所有匹配到的 "grey" 都替换成 "gray"，我就可以使用下列的函数：

```javascript
function test(str) {
  return str.replace(/grey*/g, 'gray');
}

console.log(test('grey grey  grey gay'));  // "gray gray  gray gay"
```

本章的内容不多，但需要好好的记住，因为这会在我们后面使用到的。